<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.manyi.rating.dao.mapper.ScoreStrategyMapper">

    <!-- 映射关系 -->
    <resultMap id="StrategyResultMap" type="com.manyi.rating.entity.score.GradeStrategy">
        <id column="ID" property="id"/>
        <result column="GradeStrategyID" property="gradeStrategyID"/>
        <result column="ScoreRule" property="scoreRule"/>
        <result column="GradeStrategyName" property="gradeStrategyName"/>
    </resultMap>


    <!-- 映射关系 -->
    <resultMap id="StrategyItemResultMap" type="com.manyi.rating.entity.score.GradeStrategyItem">
        <id column="ID" property="id"/>
        <result column="GradeStrategyID" property="gradeStrategyID"/>
        <result column="name" property="name"/>
        <result column="Weight" property="weight"/>
    </resultMap>


    <!-- 基础字段 -->
    <sql id="Base_Strategy_List">
        id, gradeStrategyID, ScoreRule, gradeStrategyName
    </sql>

    <!-- item基础字段 -->
    <sql id="Base_StrategyItem_List">
        id, GradeStrategyID, name, Weight
    </sql>

    <!-- 查询指定策略 -->
    <select id="getGradeStrategy" parameterType="String" resultType="com.manyi.rating.entity.score.GradeStrategy">
        SELECT
        <include refid="Base_Strategy_List"/>
        FROM t_GradeStrategy
        WHERE
        GradeStrategyID = #{gradeStrategyID}
    </select>


    <!-- 条件查询多个评价策略 -->
    <select id="getGradeStrategyList" parameterType="String"  resultMap="StrategyResultMap">
        SELECT
        <include refid="Base_Strategy_List"/>
        FROM t_GradeStrategy
    </select>

    <!-- 通用条件 -->
    <sql id="conditionSQL">
        <trim prefix="where" prefixOverrides="AND">
            <if test="gradeStrategyID != null">
                AND GradeStrategyID = #{gradeStrategyID}
            </if>
            <if test="scoreRule != null">
                AND ScoreRule = #{scoreRule}
            </if>
            <if test="gradeStrategyName != null">
                AND GradeStrategyName = #{gradeStrategyName}
            </if>
        </trim>
    </sql>

    <!-- 条件查询多个评价策略 -->
    <select id="getGradeStrategyItem" parameterType="String"  resultMap="StrategyItemResultMap">
        SELECT
        <include refid="Base_StrategyItem_List"/>
        FROM t_ItemDetail
        WHERE
        GradeStrategyID = #{gradeStrategyID}
    </select>

    <!-- 添加评价 -->
    <insert id="addGradeStrategy" parameterType="com.manyi.rating.entity.score.GradeStrategy"
            useGeneratedKeys="true" keyProperty="id">
        INSERT INTO
        t_GradeStrategy
        (gradeStrategyID, ScoreRule, gradeStrategyName)
        values
        (#{gradeStrategyID},#{scoreRule},#{gradeStrategyName})
    </insert>

    <!-- 添加评价子项 -->
    <insert id="addGradeStrategyItem" parameterType="com.manyi.rating.entity.score.GradeStrategyItem"
            useGeneratedKeys="true" keyProperty="id">
        INSERT INTO
        t_ItemDetail
        (GradeStrategyID, name, Weight)
        values
        (#{gradeStrategyID},#{name},#{weight})
    </insert>

    <!-- 编辑策略 -->
    <update id="editGradeStrategy" parameterType="com.manyi.rating.entity.score.GradeStrategy">
        UPDATE
        t_GradeStrategy
            <set>
            <if test="scoreRule != null">scoreRule = #{scoreRule},</if>
            <if test="gradeStrategyName != null">gradeStrategyName = #{gradeStrategyName},</if>
        </set>
        WHERE id = #{id}
    </update>

    <!-- 编辑策略详情 -->
    <update id="editGradeStrategyItem" parameterType="com.manyi.rating.entity.score.GradeStrategyItem">
        UPDATE
        t_ItemDetail
        <set>
            <if test="name != null">name = #{name},</if>
            <if test="weight != null">weight = #{weight},</if>
        </set>
        WHERE id = #{id}
    </update>

    <!-- 删除策略 -->
    <update id="deleteGradeStrategy" parameterType="String">
        DELETE FROM
          t_GradeStrategy
        WHERE gradeStrategyID = #{gradeStrategyID}
    </update>


    <!-- 删除策略详情 -->
    <update id="delGradeStrategyItem" parameterType="String">
        DELETE FROM
        t_ItemDetail
        WHERE gradeStrategyID = #{gradeStrategyID}
    </update>

</mapper>